!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require(".")):"function"==typeof define&&define.amd?define(["."],e):e(t._)}(this,function(t){"use strict";class e{replaceBySyncSource(t){this.nextSource=t}hasSource(){return null!==this.nextSource&&void 0!==this.nextSource}execute(t){throw new Error("Method not implemented.")}}class r{static isPromise(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}static distinct(t){return t.filter((t,e,r)=>r.indexOf(t)===e).filter(t=>void 0!=t)}static getSingle(t){if(t.length>1)throw new Error("The collection does not contain exactly one element");if(1===t.length)return t[0]}static compare(t,e){if(t===e)return!0;const r=Array.isArray(t),s=Array.isArray(e);if(r&&s){if(t.length!==e.length)return!1;for(let r=0,s=t.length;r<s;r++){if(!this.compare(t[r],e[r]))return!1}return!0}if("object"==typeof t&&"object"==typeof e){const r=Object.keys(t);for(let s=0,i=r.length;s<i;s++){if(!this.compare(t[r[s]],e[r[s]]))return!1}return!0}return!1}}class s extends e{constructor(t){super(),this._iterator=t}execute(t){return!!t&&t.some(t=>this._iterator(t))}}class i extends e{constructor(t){super(),this._iterator=t}execute(t){return t?t.map(t=>this._iterator(t)):t}}class n extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return 0;let e=this._iterator?new i(this._iterator).execute(t):t;if(!e)return 0;if(Number.isNaN(e[0]))throw new Error("Avarage operator need type of number");return e.reduce((t,e)=>t+e,0)/e.length}}class o extends e{constructor(t){super(),this._entity=t}execute(t){if(!t)return!1;let e=!1;for(let s=0,i=t.length;s<i;s++)if(r.compare(t[s],this._entity)){e=!0;break}return e}}class u extends e{constructor(t){super(),this._iterator=t}execute(t){return t?this._iterator?t.filter(t=>this._iterator(t)).length||0:t.length:0}}class c extends e{constructor(t){super(),this._iterator=t}execute(t){return this._iterator?t.filter(t=>this._iterator(t))[0]:t[0]}}class l extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return null;let e={},s=[],n={},o=r.distinct(new i(this._iterator).execute(t));return t.forEach((t,r)=>{e[r]=t}),s=t.map((t,e)=>({value:this._iterator(t),index:e})).filter(t=>void 0!=t.value),o.forEach(t=>{n[t]=[]}),n?(s.forEach(t=>{n[t.value].push(e[t.index])}),Object.keys(n).map(t=>({key:t,items:n[t]}))):null}}class h extends e{constructor(t,e){super(),this._iterator=e,this.nextSource=t}execute(t){if(t){let e=[];for(let r=0,s=t.length;r<s;r++)for(let s=0,i=this.nextSource.length;s<i;s++){const i=t[r],n=this.nextSource[s];this._iterator(i,n)&&e.push({x:i,y:n})}return e}return t}}class a extends e{constructor(t,e,r){super(),this._joinIterator=e,this._groupIterator=r,this.nextSource=t}execute(t){if(!t)return null;let e=new h(this.nextSource,this._joinIterator).execute(t);return e=new l(this._groupIterator).execute(e)}}class x extends e{constructor(t){super(),this._iterator=t}execute(t){return t?this._iterator?t.filter(t=>this._iterator(t))[t.length-1]:t[t.length-1]:null}}class f extends e{constructor(t,e){super(),this._iterator=e,this.nextSource=t}execute(t){if(t){let e=[];for(let r=0,s=t.length;r<s;r++){let s=!1;for(let i=0,n=this.nextSource.length;i<n;i++)if(this._iterator(t[r],this.nextSource[i])){e.push(Object.assign({},t[r],this.nextSource[i])),s=!0;break}s||e.push(Object.assign({},t[r],null))}return e}return t}}class p extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return 0;let e;if(this._iterator&&(e=new i(this._iterator).execute(t)),!e)return 0;if(!Number.isNaN(e[0]))throw new Error("Max operator require type of number");return Math.max(...e)}}class _ extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return 0;let e;if(this._iterator&&(e=new i(this._iterator).execute(t)),!e)return 0;if(!Number.isNaN(e[0]))throw new Error("Min operator require type of number");return Math.min(...e)}}class w extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return null;let e={};t.forEach((t,r)=>{e[r]=t});let r=t.map((t,e)=>({value:this._iterator(t),index:e}));return r?(r.sort((t,e)=>t.value<e.value?-1:t.value>e.value?1:0),r.map(t=>e[t.index])):null}}class d extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return null;return new w(this._iterator).execute(t).reverse()}}class g extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return null;let e=new i(this._iterator).execute(t);if(!e)return null;let r=[];for(let t=0,s=e.length;t<s;t++)Array.isArray(e[t])?r=r.concat(e[t]):r.push(e[t]);return r}}class m extends e{constructor(t){super(),this._iterator=t}execute(t){return t?t.filter(t=>this._iterator(t)):t}}class S extends e{constructor(t){super(),this._iterator=t}execute(t){let e=t;return this._iterator&&(e=new m(this._iterator).execute(e)),r.getSingle(e)}}class y extends e{constructor(t){super(),this._iterator=t}execute(t){return t?t.slice(this._iterator):t}}class C extends e{constructor(t){super(),this._iterator=t}execute(t){if(t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];if(this._iterator(s))break;e+=1}return new y(e).execute(t)}return null}}class b extends e{constructor(t){super(),this._iterator=t}execute(t){if(!t)return 0;let e;if(this._iterator&&(e=new i(this._iterator).execute(t)),!e)return 0;if(Number.isNaN(e[0]))throw new Error("Sum operator need type of number");return e.reduce((t,e)=>t+e,0)}}class v extends e{constructor(t){super(),this._iterator=t}execute(t){return t?t.slice(0,this._iterator):t}}class L extends e{constructor(t){super(),this._iterator=t}execute(t){if(t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];if(this._iterator(s))break;e+=1}return new v(e).execute(t)}return null}}class R extends e{constructor(t){super(),this._iterator=t}execute(t){return!!t&&t.every(t=>this._iterator(t))}}class E extends e{constructor(t){super(),this.nextSource=t}execute(t){return t.concat(this.nextSource)}}class j extends e{constructor(t){super(),this._comparer=t}execute(t){if(!this._comparer)return r.distinct(t)}}class k extends e{constructor(t){super(),this.nextSource=t}execute(e){let r=e.concat(this.nextSource);return(new t.DistinctClause).execute(r)}}class N extends e{constructor(t){super(),this.nextSource=t}execute(e){let s=[];for(let t=0,i=e.length;t<i;t++)for(let i=0,n=this.nextSource.length;i<n;i++)r.compare(e[t],this.nextSource[i])&&s.push(e[t]);return s?(new t.DistinctClause).execute(s):null}}class O extends e{constructor(t){super(),this.nextSource=t}execute(t){if(t.length!==this.nextSource.length)return!1;for(let e=0,s=t.length;e<s;e++)if(!r.compare(t[e],this.nextSource[e]))return!1;return!0}}class P extends e{constructor(t){super(),this.nextSource=t}execute(t){let e=[];for(let s=0,i=t.length;s<i;s++){let i=!1;for(let e=0,n=this.nextSource.length;e<n;e++)if(r.compare(t[s],this.nextSource[e])){i=!0;break}i||e.push(t[s])}return e||null}}class A extends e{constructor(t,e){super(),this.nextSource=t,this._iterator=e}execute(t){const e=t.length,r=this.nextSource.length,s=e>r?r:e;return t.map((t,e)=>{if(!(e>s-1))return this._iterator?this._iterator(t,this.nextSource[e]):[t,this.nextSource[e]]}).filter(t=>void 0!==t)}}class I extends e{constructor(t){super(),this._iterator=t}execute(t){return t.reduce((t,e,r)=>this._iterator(t,e,r))}}class q{constructor(t,e){this._iteratorCollection=[],this._iteratorCollection=t,this._source=e}clone(){const t=Object.assign([],this._iteratorCollection);return new q(t,this._source)}where(t){return this._iteratorCollection.push(new m(t)),this}select(t){return this._iteratorCollection.push(new i(t)),this}selectMany(t){return this._iteratorCollection.push(new g(t)),this}join(t,e){return this._iteratorCollection.push(new h(t,e)),this}leftJoin(t,e){return this._iteratorCollection.push(new f(t,e)),this}orderBy(t){return this._iteratorCollection.push(new w(t)),this}orderByDescending(t){return this._iteratorCollection.push(new d(t)),this}groupBy(t){return this._iteratorCollection.push(new l(t)),this}groupJoin(t,e,r){return this._iteratorCollection.push(new a(t,e,r)),this}distinct(t){return this._iteratorCollection.push(new j(t)),this}concat(t){return this._iteratorCollection.push(new E(t)),this}union(t){return this._iteratorCollection.push(new k(t)),this}zip(t,e){return this._iteratorCollection.push(new A(t,e)),this}except(t){return this._iteratorCollection.push(new P(t)),this}intersect(t){return this._iteratorCollection.push(new N(t)),this}toList(){return this.runIterators()}first(t){return this.filterReturn(this.toList(),e=>new c(t).execute(e))}firstOrDefault(t){return this.filterReturn(this.toList(),e=>new c(t).execute(e)||null)}last(t){return this.filterReturn(this.toList(),e=>new x(t).execute(e))}lastOrDefault(t){return this.filterReturn(this.toList(),e=>new x(t).execute(e)||null)}count(t){return this.filterReturn(this.toList(),e=>new u(t).execute(e)||null)}sum(t){return this.filterReturn(this.toList(),e=>new b(t).execute(e)||null)}avarage(t){return this.filterReturn(this.toList(),e=>new n(t).execute(e)||0)}min(t){return this.filterReturn(this.toList(),e=>new _(t).execute(e)||null)}max(t){return this.filterReturn(this.toList(),e=>new p(t).execute(e)||null)}single(t){return this.filterReturn(this.toList(),e=>{if(!e)throw new Error("Single require source is not null");return new S(t).execute(e)})}singleOrDefault(t){return this.filterReturn(this.toList(),e=>new S(t).execute(e)||null)}take(t){return this._iteratorCollection.push(new v(t)),this}skip(t){return this._iteratorCollection.push(new y(t)),this}skipWhile(t){return this._iteratorCollection.push(new C(t)),this}takeWhile(t){return this._iteratorCollection.push(new L(t)),this}any(t){return this.filterReturn(this.toList(),e=>new s(t).execute(e))}all(t){return this.filterReturn(this.toList(),e=>new R(t).execute(e))}contains(t){return this.filterReturn(this.toList(),e=>new o(t).execute(e))}sequencyEqual(t){return this.filterReturn(this.toList(),e=>r.isPromise(t)?t.then(t=>new O(t).execute(e)):new O(t).execute(e))}aggregate(t){return this.filterReturn(this.toList(),e=>new I(t).execute(e))}filterReturn(t,e){return r.isPromise(t)?t.then(t=>e(t)):e(t)}runIterators(){let t=[],e=[];for(let t=0,s=this._iteratorCollection.length;t<s;t++){let s=this._iteratorCollection[t];s.hasSource()&&(r.isPromise(s.nextSource)?e.push(s.nextSource):e.push(Promise.resolve(s.nextSource)))}return r.isPromise(this._source)?e.unshift(this._source):e.unshift(Promise.resolve(this._source)),Promise.all(e).then(e=>{let r=0;t=e[0];for(let t=0,s=this._iteratorCollection.length;t<s;t++){let s=this._iteratorCollection[t];s.hasSource()&&(s.replaceBySyncSource(e[r+1]),r+=1)}return this._iteratorCollection.forEach(e=>{t=e.execute(t)}),t})}}class D extends q{runIterators(){let t=Object.assign([],this._source);return this._iteratorCollection.forEach(e=>{t=e.execute(t)}),t}}window.Queryable=class{static from(t){return new q([],t)}static fromSync(t){return new D([],t)}}});
